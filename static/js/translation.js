const translations = {
    en: {
        'home': 'Home',
        'search': 'Search',
        'admin-dashboard': 'Admin Dashboard',
        'owner-dashboard': 'Owner Dashboard',
        'add-homestay': 'Add Homestay',
        'renter-dashboard': 'Renter Dashboard',
        'my-profile': 'My Profile',
        'login': 'Login',
        'register': 'Register',
        'logout': 'Logout',
        'about-homestay': 'About Homestay Booking',
        'platform-desc': 'A platform connecting homestay owners with travelers looking for unique accommodations.',
        'links': 'Links',
        'contact': 'Contact',
        'homestay-booking': 'Homestay Booking',
        'find-perfect-homestay': 'Find Your Perfect Homestay',
        'book-description': 'Book unique accommodations or list your property to earn extra income.',
        'explore-description': 'Explore our selection of homestays or create an account to get started.',
        'find-homestay-btn': 'Find a Homestay',
        'featured-homestays': 'Featured Homestays',
        'view-details': 'View Details',
        'your-homestays': 'Your Homestays',
        'manage-homestays-desc': 'Manage your homestays and view their status.',
        'view-all': 'View All',
        'email': 'Email',
        'phone': 'Phone',
        'copyright': '© 2025 Homestay Booking - School Project',
        'available-rooms': 'Available Rooms',
        'room': 'Room',
        'address': 'Address',
        'beds': 'Beds',
        'bathrooms': 'Bathrooms',
        'capacity': 'Capacity',
        'price-per-hour': 'Price per hour',
        'view-room': 'View Room',
        'book-room': 'Book Room',
        'reviews': 'Reviews',
        'amenities': 'Amenities',
        'description': 'Description',
        'booking-details': 'Booking Details',
        'check-in': 'Check-in',
        'check-out': 'Check-out',
        'total-price': 'Total Price',
        'confirm-booking': 'Confirm Booking',
        'cancel': 'Cancel',
        'booking-success': 'Booking Successful',
        'booking-failed': 'Booking Failed',
        'no-reviews': 'No reviews yet',
        'write-review': 'Write a Review',
        'rating': 'Rating',
        'review-text': 'Your Review',
        'submit-review': 'Submit Review',
        'photos': 'Photos',
        'location': 'Location',
        'host': 'Host',
        'contact-host': 'Contact Host',
        'similar-rooms': 'Similar Rooms',
        'room-rules': 'Room Rules',
        'availability': 'Availability',
        'facilities': 'Facilities',
        'no-images': 'No images available for this room',
        'room-details': 'Room Details',
        'back-to-homestay': 'Back to Homestay',
        'guests': 'Guests',
        'price-format': '${0} per hour',
        'bed-count': '{0} Bed(s)',
        'bathroom-count': '{0} Bathroom(s)',
        'guest-count': '{0} Guests',
        'leveling-to': 'Leveling to',
        'xp-progress': '{0}/{1} XP',
        'bronze': 'Bronze',
        'silver': 'Silver',
        'gold': 'Gold',
        'platinum': 'Platinum',
        'emerald': 'Emerald',
        'diamond': 'Diamond',
        'full-name': 'Full Name',
        'phone-number': 'Phone Number',
        'personal-id': 'Personal ID',
        'change-avatar': 'Change Avatar',
        'update-profile': 'Update Profile',
        'max-rank': 'Already at Diamond Rank!',
        'unnamed-user': 'Unnamed User',
        'leveling-progress': 'Leveling Progress',
        'current-xp': 'Current XP',
        'filter-options': 'Filter Options',
        'city': 'City',
        'all-cities': 'All Cities',
        'district': 'District',
        'all-districts': 'All Districts',
        'min-price-per-hour': 'Min Price per Hour ($)',
        'max-price-per-hour': 'Max Price per Hour ($)',
        'minimum-bedrooms': 'Minimum Bedrooms',
        'apply-filters': 'Apply Filters',
        'available-homestays': 'Available Homestays',
        'no-rooms': 'No rooms yet',
        'book-now': 'Book Now',
        'no-homestays-found': 'No homestays found matching your criteria. Try adjusting your filters.',
        'create-owner': 'Create Owner',
        'admin-only-area': 'This is an admin-only area.',
        'all-owners': 'All Owners',
        'owner-id': 'Owner ID',
        'username': 'Username',
        'homestays': 'Homestays',
        'room-number': 'Room #',
        'baths': 'baths',
        'price': 'Price',
        'no-homestays': 'No homestays yet',
        'view-all-bookings': 'View All Bookings',
        'homestay-name': 'Homestay Name',
        'manage-rooms': 'Manage Rooms',
        'edit': 'Edit',
        'delete': 'Delete',
        'switch-to-renter': 'Switch to Renter',
        'switch-to-owner': 'Switch to Owner',
        'booking-history': 'Booking History',
        'settings': 'Settings',
        'notification-settings': 'Notification Settings',
        'email-notifications': 'Email Notifications',
        'booking-reminders': 'Booking Reminders',
        'save-changes': 'Save Changes',
        'privacy-settings': 'Privacy Settings',
        'show-profile': 'Show Profile to Other Users',
        'show-booking-history': 'Show Booking History',
        'language-settings': 'Language Settings',
        'preferred-language': 'Preferred Language',
        'danger-zone': 'Danger Zone',
        'danger-zone-desc': 'These actions cannot be undone.',
        'delete-account': 'Delete Account',
        'confirm-delete-account': 'Confirm Account Deletion',
        'delete-account-warning': 'Warning: This action cannot be undone. All your data will be permanently deleted.',
        'confirm-password': 'Confirm Password',
        'confirm-delete': 'Confirm Delete',
        'status': 'Status',
        'no-bookings': 'You don\'t have any bookings yet.',
        'appearance-settings': 'Appearance Settings',
        'color-theme': 'Color Theme',
        'dark-mode': 'Dark Mode',
        'login-to-account': 'Login to Your Account',
        'username-or-email': 'Username or Email',
        'password': 'Password',
        'remember-me': 'Remember me',
        'or': 'OR',
        'login-with-facebook': 'Login with Facebook',
        'login-with-google': 'Login with Google',
        'no-account': 'Don\'t have an account?'
    },
    vi: {
        'home': 'Trang chủ',
        'search': 'Tìm kiếm',
        'admin-dashboard': 'Quản trị viên',
        'owner-dashboard': 'Quản lý chủ nhà',
        'add-homestay': 'Thêm Homestay',
        'renter-dashboard': 'Bảng điều khiển',
        'my-profile': 'Hồ sơ của tôi',
        'login': 'Đăng nhập',
        'register': 'Đăng ký',
        'logout': 'Đăng xuất',
        'about-homestay': 'Về Homestay Booking',
        'platform-desc': 'Nền tảng kết nối chủ nhà với khách du lịch tìm kiếm chỗ ở độc đáo.',
        'links': 'Liên kết',
        'contact': 'Liên hệ',
        'homestay-booking': 'Homestay Booking',
        'find-perfect-homestay': 'Tìm Homestay Lý Tưởng',
        'book-description': 'Đặt phòng độc đáo hoặc đăng ký cho thuê để tăng thêm thu nhập.',
        'explore-description': 'Khám phá danh sách homestay của chúng tôi hoặc tạo tài khoản để bắt đầu.',
        'find-homestay-btn': 'Tìm Homestay',
        'featured-homestays': 'Homestay Nổi Bật',
        'view-details': 'Xem Chi Tiết',
        'your-homestays': 'Homestay Của Bạn',
        'manage-homestays-desc': 'Quản lý homestay và xem trạng thái của chúng.',
        'view-all': 'Xem Tất Cả',
        'email': 'Email',
        'phone': 'Điện thoại',
        'copyright': '© 2025 Đặt Phòng Homestay - Dự Án Học Tập',
        'available-rooms': 'Phòng Còn Trống',
        'room': 'Phòng',
        'address': 'Địa chỉ',
        'beds': 'Giường',
        'bathrooms': 'Phòng tắm',
        'capacity': 'Sức chứa',
        'price-per-hour': 'Giá mỗi giờ',
        'view-room': 'Xem Phòng',
        'book-room': 'Đặt Phòng',
        'reviews': 'Đánh giá',
        'amenities': 'Tiện nghi',
        'description': 'Mô tả',
        'booking-details': 'Chi tiết đặt phòng',
        'check-in': 'Giờ vào',
        'check-out': 'Giờ ra',
        'total-price': 'Tổng tiền',
        'confirm-booking': 'Xác nhận đặt phòng',
        'cancel': 'Hủy',
        'booking-success': 'Đặt phòng thành công',
        'booking-failed': 'Đặt phòng thất bại',
        'no-reviews': 'Chưa có đánh giá nào',
        'write-review': 'Viết đánh giá',
        'rating': 'Xếp hạng',
        'review-text': 'Đánh giá của bạn',
        'submit-review': 'Gửi đánh giá',
        'photos': 'Hình ảnh',
        'location': 'Vị trí',
        'host': 'Chủ nhà',
        'contact-host': 'Liên hệ chủ nhà',
        'similar-rooms': 'Phòng tương tự',
        'room-rules': 'Nội quy phòng',
        'availability': 'Tình trạng phòng',
        'facilities': 'Cơ sở vật chất',
        'no-images': 'Không có hình ảnh cho phòng này',
        'room-details': 'Chi tiết phòng',
        'back-to-homestay': 'Quay lại Homestay',
        'guests': 'Khách',
        'price-format': '{0}đ mỗi giờ',
        'bed-count': '{0} Giường',
        'bathroom-count': '{0} Phòng tắm',
        'guest-count': '{0} Khách',
        'leveling-to': 'Đang lên cấp',
        'xp-progress': '{0}/{1} XP',
        'bronze': 'Đồng',
        'silver': 'Bạc',
        'gold': 'Vàng',
        'platinum': 'Bạch Kim',
        'emerald': 'Ngọc Lục Bảo',
        'diamond': 'Kim Cương',
        'full-name': 'Họ và Tên',
        'phone-number': 'Số Điện Thoại',
        'personal-id': 'CMND/CCCD',
        'change-avatar': 'Đổi Ảnh Đại Diện',
        'update-profile': 'Cập Nhật Hồ Sơ',
        'max-rank': 'Đã đạt cấp độ Bạch Kim!',
        'unnamed-user': 'Chưa đặt tên',
        'leveling-progress': 'Tiến Trình Cấp Độ',
        'current-xp': 'Điểm Kinh Nghiệm',
        'filter-options': 'Tùy Chọn Lọc',
        'city': 'Thành Phố',
        'all-cities': 'Tất Cả Thành Phố',
        'district': 'Quận/Huyện',
        'all-districts': 'Tất Cả Quận/Huyện',
        'min-price-per-hour': 'Giá Tối Thiểu Mỗi Giờ (đ)',
        'max-price-per-hour': 'Giá Tối Đa Mỗi Giờ (đ)',
        'minimum-bedrooms': 'Số Phòng Ngủ Tối Thiểu',
        'apply-filters': 'Áp Dụng Bộ Lọc',
        'available-homestays': 'Homestay Hiện Có',
        'no-rooms': 'Chưa có phòng',
        'book-now': 'Đặt Ngay',
        'no-homestays-found': 'Không tìm thấy homestay phù hợp. Hãy thử điều chỉnh bộ lọc.',
        'create-owner': 'Tạo Chủ Nhà',
        'admin-only-area': 'Đây là khu vực dành riêng cho quản trị viên.',
        'all-owners': 'Danh Sách Chủ Nhà',
        'owner-id': 'ID Chủ Nhà',
        'username': 'Tên Đăng Nhập',
        'homestays': 'Homestay',
        'room-number': 'Phòng số',
        'baths': 'phòng tắm',
        'price': 'Giá',
        'no-homestays': 'Chưa có homestay',
        'view-all-bookings': 'Xem thông tin đặt phòng',
        'homestay-name': 'Tên Homestay',
        'manage-rooms': 'Quản Lý Phòng',
        'edit': 'Sửa',
        'delete': 'Xóa',
        'switch-to-renter': 'Chuyển sang Người thuê',
        'switch-to-owner': 'Chuyển sang Chủ nhà',
        'booking-history': 'Lịch sử đặt phòng',
        'settings': 'Cài đặt',
        'notification-settings': 'Cài đặt thông báo',
        'email-notifications': 'Thông báo qua email',
        'booking-reminders': 'Nhắc nhở đặt phòng',
        'save-changes': 'Lưu thay đổi',
        'privacy-settings': 'Cài đặt quyền riêng tư',
        'show-profile': 'Hiển thị hồ sơ với người dùng khác',
        'show-booking-history': 'Hiển thị lịch sử đặt phòng',
        'language-settings': 'Cài đặt ngôn ngữ',
        'preferred-language': 'Ngôn ngữ ưa thích',
        'danger-zone': 'Vùng nguy hiểm',
        'danger-zone-desc': 'Những hành động này không thể hoàn tác.',
        'delete-account': 'Xóa tài khoản',
        'confirm-delete-account': 'Xác nhận xóa tài khoản',
        'delete-account-warning': 'Cảnh báo: Hành động này không thể hoàn tác. Tất cả dữ liệu của bạn sẽ bị xóa vĩnh viễn.',
        'confirm-password': 'Xác nhận mật khẩu',
        'confirm-delete': 'Xác nhận xóa',
        'status': 'Trạng thái',
        'no-bookings': 'Bạn chưa có đặt phòng nào.',
        'appearance-settings': 'Cài đặt giao diện',
        'color-theme': 'Chủ đề màu',
        'dark-mode': 'Chế độ tối',
        'login-to-account': 'Đăng nhập vào tài khoản của bạn',
        'username-or-email': 'Tên đăng nhập hoặc Email',
        'password': 'Mật khẩu',
        'remember-me': 'Ghi nhớ đăng nhập',
        'or': 'HOẶC',
        'login-with-facebook': 'Đăng nhập bằng Facebook',
        'login-with-google': 'Đăng nhập bằng Google',
        'no-account': 'Bạn chưa có tài khoản?'
    }
};

// Thiết lập ngôn ngữ mặc định
let currentLang = localStorage.getItem('language') || 'vi';

// Hàm định dạng số
function formatNumber(number, decimals = 2) {
    return Number(parseFloat(number)).toFixed(decimals);
}

// Thêm các tùy chọn ngôn ngữ
const languages = [
    { 
        code: 'vi', 
        name: 'Việt Nam', 
        flag: '<img src="/static/images/flags/vn.svg" alt="VN" class="flag-img">' 
    },
    { 
        code: 'en', 
        name: 'Global (English)', 
        flag: '<img src="/static/images/flags/world.svg" alt="Global" class="flag-img">' 
    }
];

// Thêm hàm để hiển thị menu ngôn ngữ
function showLanguageMenu() {
    // Kiểm tra xem menu đã tồn tại chưa
    let existingMenu = document.getElementById('languageDropdownMenu');
    if (existingMenu) {
        existingMenu.remove();
        return;
    }

    // Tạo menu dropdown
    const menu = document.createElement('div');
    menu.id = 'languageDropdownMenu';
    menu.className = 'language-dropdown-menu';
    menu.style.position = 'absolute';
    menu.style.backgroundColor = 'white';
    menu.style.border = '1px solid #ddd';
    menu.style.borderRadius = '10px';
    menu.style.padding = '15px';
    menu.style.zIndex = '1050';
    menu.style.boxShadow = '0 5px 20px rgba(0,0,0,0.15)';

    languages.forEach(lang => {
        const option = document.createElement('div');
        option.className = 'language-option';
        option.style.padding = '12px 15px';
        option.style.cursor = 'pointer';
        option.style.borderRadius = '8px';
        option.style.display = 'flex';
        option.style.alignItems = 'center';
        option.style.marginBottom = '8px';
        
        // Highlight the current language
        if (currentLang === lang.code) {
            option.classList.add('active');
            option.style.backgroundColor = '#f0f0f0';
            option.style.fontWeight = 'bold';
        }
        
        option.innerHTML = `${lang.flag} ${lang.name}`;
        
        option.addEventListener('mouseover', () => {
            if (currentLang !== lang.code) {
                option.style.backgroundColor = '#f8f9fa';
                option.style.transform = 'translateX(3px)';
            }
        });
        
        option.addEventListener('mouseout', () => {
            if (currentLang !== lang.code) {
                option.style.backgroundColor = 'transparent';
                option.style.transform = 'translateX(0)';
            }
        });
        
        option.addEventListener('click', () => {
            setLanguage(lang.code);
            menu.remove();
        });
        
        menu.appendChild(option);
    });

    // Định vị menu dưới nút
    const langBtn = document.getElementById('languageToggle');
    if (!langBtn) return;
    
    const rect = langBtn.getBoundingClientRect();
    menu.style.top = (rect.bottom + window.scrollY) + 'px';
    menu.style.right = (window.innerWidth - rect.right) + 'px';

    // Thêm vào body
    document.body.appendChild(menu);

    // Thêm sự kiện đóng menu khi click ra ngoài
    document.addEventListener('click', function closeMenu(e) {
        if (!menu.contains(e.target) && e.target !== langBtn) {
            menu.remove();
            document.removeEventListener('click', closeMenu);
        }
    });
}

// Hàm đặt ngôn ngữ
function setLanguage(lang) {
    currentLang = lang;
    localStorage.setItem('language', lang);
    updateContent();
    updateLanguageButton();
}

// Hàm cập nhật nút chuyển đổi ngôn ngữ
function updateLanguageButton() {
    const langBtn = document.getElementById('languageToggle');
    if (!langBtn) return;
    
    const lang = languages.find(l => l.code === currentLang);
    if (lang) {
        if (currentLang === 'en') {
            langBtn.innerHTML = `<img src="/static/images/flags/world.svg" alt="Global" class="flag-img"><span>EN</span>`;
        } else {
            langBtn.innerHTML = `${lang.flag} <span>${currentLang.toUpperCase()}</span>`;
        }
    }
}

// Cập nhật hàm toggleLanguage để hiển thị menu
function toggleLanguage(event) {
    if (event) {
        event.preventDefault();
        event.stopPropagation();
    }
    showLanguageMenu();
}

// Hàm cập nhật nội dung dựa trên ngôn ngữ
function updateContent() {
    document.querySelectorAll('[data-translate]').forEach(element => {
        const key = element.getAttribute('data-translate');
        if (translations[currentLang] && translations[currentLang][key]) {
            let text = translations[currentLang][key];
            
            if (element.hasAttribute('data-xp')) {
                const xp = formatNumber(element.getAttribute('data-xp'));
                const nextMin = element.getAttribute('data-next-min');
                text = text.replace('{0}', xp).replace('{1}', nextMin);
            }
            
            element.textContent = text;
        }
    });
    
    // Cập nhật thuộc tính lang của HTML
    const htmlRoot = document.getElementById('htmlRoot');
    if (htmlRoot) {
        htmlRoot.setAttribute('lang', currentLang);
    }
    
    // Cập nhật nút ngôn ngữ
    updateLanguageButton();
}

// Khởi tạo ngôn ngữ khi trang được tải
document.addEventListener('DOMContentLoaded', () => {
    // Đảm bảo ngôn ngữ mặc định là tiếng Việt khi tải trang đầu tiên
    if (!localStorage.getItem('language')) {
        localStorage.setItem('language', 'vi');
        currentLang = 'vi';
    }
    updateContent();
});

// Gọi updateContent ngay khi có thể
if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', updateContent);
} else {
    updateContent();
}