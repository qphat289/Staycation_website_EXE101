{% extends 'base.html' %}
{% block title %}Renter Dashboard{% endblock %}

{% block content %}
<h2>Renter Dashboard</h2>
<hr>

{% if bookings %}
  {% for booking in bookings %}
    <div class="card mb-3">
      <div class="card-body d-flex justify-content-between align-items-center">
        
        <!-- Left side: Homestay name + Room + Status + Times -->
        <div>
          {% if booking.room is not none %}
            <h5 class="card-title mb-1">
              {{ booking.room.homestay.title }} - Room {{ booking.room.room_number }}
            </h5>
          {% else %}
            <h5 class="card-title mb-1">Room not assigned</h5>
          {% endif %}
          
          <!-- Time Booked -->
          <p class="mb-1">
            <strong>From:</strong> {{ booking.start_time.strftime('%Y-%m-%d %H:%M') }}<br>
            <strong>To:</strong> {{ booking.end_time.strftime('%Y-%m-%d %H:%M') }}
          </p>
          
          <!-- Status with color-coded badge -->
          {% if booking.status == 'cancelled' %}
            <span class="badge bg-danger">Cancelled</span>
          {% elif booking.status == 'completed' %}
            <span class="badge bg-success">Completed</span>
          {% elif booking.status == 'pending' %}
            <span class="badge bg-warning">Pending</span>
          {% else %}
            <span class="badge bg-secondary">{{ booking.status }}</span>
          {% endif %}
        </div>

        <!-- Right side: Buttons -->
        <div>
          <!-- Cancel Booking: only show if booking not cancelled or completed -->
          {% if booking.status not in ['cancelled', 'completed'] %}
            <a href="{{ url_for('renter.cancel_booking', id=booking.id) }}" class="btn btn-danger btn-sm me-2">
              Cancel
            </a>
          {% endif %}

          <!-- Book Again: clickable if booking is completed or cancelled, only if room exists -->
          {% if booking.room is not none and booking.status in ['cancelled', 'completed'] %}
            <a href="{{ url_for('renter.book_homestay', id=booking.room.homestay.id) }}" class="btn btn-primary btn-sm me-2">
              Book Again
            </a>
          {% else %}
            <button class="btn btn-primary btn-sm me-2" disabled>Book Again</button>
          {% endif %}

          <!-- Review Button: clickable if booking is completed, only if room exists -->
          {% if booking.room is not none %}
            <a href="{{ url_for('renter.view_reviews', homestay_id=booking.room.homestay.id) }}" class="btn btn-secondary btn-sm me-2">
              Review
            </a>
          {% else %}
            <button class="btn btn-secondary btn-sm me-2" disabled>Review</button>
          {% endif %}

          <!-- Details button always visible -->
          <a href="{{ url_for('renter.booking_details', booking_id=booking.id) }}" class="btn btn-info btn-sm">
            Details
          </a>
        </div>
      </div>
    </div>
  {% endfor %}
{% else %}
  <p>No bookings found.</p>
{% endif %}
{% endblock %}
