{% extends 'base.html' %}
{% block title %}View Homestay - {{ homestay.title }}{% endblock %}

{% block content %}
<h2>{{ homestay.title }}</h2>
<hr>

<!-- Homestay details -->
<p><strong>Address:</strong> {{ homestay.address }}, {{ homestay.district }}, {{ homestay.city }}</p>
{# The homestay price line is removed, as pricing is per room #}

<!-- Rooms -->
<h3>Available Rooms</h3>
<div class="row">
  {% for room in rooms %}
    <div class="col-md-4 mb-3">
      <div class="card">
        <div class="card-body">
          <h5 class="card-title">Room {{ room.room_number }}</h5>
          <p class="card-text">
            Beds: {{ room.bed_count }}<br>
            Bathrooms: {{ room.bathroom_count }}<br>
            Capacity: {{ room.max_guests }}<br>
            <strong>Price per hour:</strong> ${{ room.price_per_hour }}
          </p>

          <!-- Display featured image or first image from room gallery -->
          {% if room.images and room.images|length > 0 %}
            {% set featured_img = room.images|selectattr("is_featured", "equalto", True)|list %}
            {% if featured_img %}
              <img src="{{ url_for('static', filename=featured_img[0].image_path) }}" 
                   alt="Featured Image"
                   style="max-width: 100px; height:auto;">
            {% else %}
              <img src="{{ url_for('static', filename=room.images[0].image_path) }}"
                   alt="Room Image"
                   style="max-width: 100px; height:auto;">
            {% endif %}
          {% else %}
            <img src="{{ url_for('static', filename='images/default-room.jpg') }}" alt="No Image"
                 style="max-width: 100px; height:auto;">
          {% endif %}
          <a href="{{ url_for('renter.book_homestay', homestay_id=homestay.id) }}?room_id={{ room.id }}" 
          class="btn btn-primary btn-sm mt-2">
         Book This Room
       </a>

          <!-- Optional: Button to view full room detail or gallery -->
          <a href="{{ url_for('renter.view_room_detail', room_id=room.id) }}" 
             class="btn btn-info btn-sm mt-2">
            View Detail
          </a>
        </div>
      </div>
    </div>
  {% endfor %}
</div>

<hr>
<!-- Reviews Section (READ-ONLY) -->
<h3>Reviews</h3>
{% if homestay.reviews.count() > 0 %}
  {% for review in reviews %}
    <div class="card mb-3">
      <div class="card-body">
        <p><strong>Rating:</strong> {{ review.rating }} / 5</p>
        <p>{{ review.content }}</p>
        <p class="text-muted">
          By {{ review.author.username }} on {{ review.created_at.strftime('%Y-%m-%d') }}
        </p>
      </div>
    </div>
  {% endfor %}
{% else %}
  <p>No reviews yet.</p>
{% endif %}

{# Removed the "Write a Review" button here since reviews are read-only on this page #}

{% endblock %}
